# 实现计划

## 1. 分析当前实现

三个智能体的call方法都使用了火山方舟的API，通过`previous_response_id`参数传递last_id来维持对话上下文。当last_id不存在或超时失效时，API会返回404错误。

## 2. 实现目标

为每个智能体的call方法添加以下逻辑：
- 检查last_id是否为None
- 捕获API调用时的404错误
- 当last_id为None或请求返回404时，调用init_assistant方法重新初始化对话

## 3. 实现步骤

### 3.1 修改director_assistant.py
- 在Assistant.call方法中添加try-except块
- 捕获volcenginesdkarkruntime的API错误
- 当last_id为None或捕获到404错误时，调用init_assistant方法

### 3.2 修改outline_writer.py
- 优化OutlineWriter.call方法中的错误处理逻辑
- 确保当API返回404错误时，调用init_assistant方法

### 3.3 修改screenwriter.py
- 在ScreenWriter.call方法中添加try-except块
- 捕获API调用时的404错误
- 当last_id为None或捕获到404错误时，调用init_assistant方法

## 4. 技术要点

- 使用try-except块捕获API错误
- 识别404错误的具体异常类型
- 确保init_assistant方法的参数正确传递
- 保持原有代码结构不变

## 5. 测试策略

- 模拟last_id为None的情况
- 模拟last_id超时失效的情况
- 确保正常情况下调用逻辑不受影响